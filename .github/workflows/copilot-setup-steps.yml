name: Copilot Setup Steps

on:
  workflow_dispatch:

jobs:
  setup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'pip'
          cache-dependency-path: 'backend/requirements.txt'

      - name: Set up Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: 'frontend/package-lock.json'

      - name: Install Python dependencies
        run: |
          cd backend
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Install Node dependencies
        run: |
          cd frontend
          npm ci

      - name: Install Playwright browsers
        run: |
          cd frontend
          npx playwright install --with-deps

      - name: Set up environment variables
        run: |
          echo "PYTHONPATH=${{ github.workspace }}/backend/src" >> $GITHUB_ENV
          echo "NODE_ENV=development" >> $GITHUB_ENV

      - name: Verify backend setup
        run: |
          cd backend
          python -c "import sys; print(f'Python version: {sys.version}')"
          pip list | grep -E "(fastapi|uvicorn|pytest|yfinance)" || echo "Install backend dependencies first"

      - name: Verify frontend setup
        run: |
          cd frontend
          node --version
          npm --version
          npx playwright --version || echo "Install Playwright first"
          echo "Frontend dependencies installed"

      - name: Display setup summary
        run: |
          echo "✅ Python 3.10 installed"
          echo "✅ Node.js 18 installed"
          echo "✅ Backend dependencies installed"
          echo "✅ Frontend dependencies installed"
          echo "✅ Playwright browsers installed"
          echo ""
          echo "To run backend: cd backend && uvicorn stocklighthouse.api.main:app --port 8000"
          echo "To run frontend: cd frontend && npm run dev"
          echo "To run tests: cd backend && pytest -q"
          echo "To run E2E tests: cd frontend && npm run build && npx playwright test"
